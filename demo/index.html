<html>
	<head>
		<title>Vote!</title>
		<link href="lib/jquery-ui-1.10.3.custom/css/vader/jquery-ui-1.10.3.custom.css" rel="stylesheet">
		<link href="index.css" rel="stylesheet">
		<script src="lib/knockout.js"></script>
		<script src="lib/mustache.js"></script>
		<script src="lib/ko.mustache.js"></script>
		<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script src="js/VoterHandler.js"></script>
		<script src="js/VoteHandler.js"></script>
		<script src="js/Voter.js"></script>
		<script src="../target/single/SocialChoice.js"></script>

		<script id="vote-order-template" type="text/x-handlebars-template">
			<li class="ui-state-default"><span data-bind="text: optionText"></span><span class="ui-icon ui-icon-arrowthick-2-n-s"></span></li>
		</script>

		<script id="voters-template" type="text/x-handlebars-template">
			<div data-bind="text: optionText"></div>
			<ul class="sortable"  data-bind="template: {name: 'vote-order-template', foreach: votes}"></ul>
		</script>
	</head>
	<body>
	<div id="voter" data-bind="template: {name: 'voters-template', foreach: voters}">
	</div>
	<div>
		<input id="voterNameInput"><button id="voterNameButton" onclick="addVoter()">Add Voter</button>
		<input id="voteNameInput"><button id="voteNameButton" onclick="addVote()">Add Vote</button>
		<button onclick="calculateVotes()">Calculate Votes</button>
		<div id="results"></div>
	</div>
	<script>
		var voterHandler = new VoterHandler();
		function addVoter() {
			var voterName = document.getElementById("voterNameInput").value;
			voterHandler.addVoter(voterName);
		}
		function addVote() {
			var voteName = document.getElementById("voteNameInput").value;
			debugger;
			voterHandler.addVote(voteName);
		}
		function calculateVotes() {
			var allVotes = voterHandler.getAllVotes();
			var allOptions = voterHandler.getAllOptions();
			var vote = new SocialChoice({
				options: allOptions
			});

			for (var index in allVotes) {
				var voters = allVotes[index];
				voters.unshift(1);
				SocialChoice.prototype.rank.apply(vote, voters);
				voters.shift(1);
			}

			var resultsDiv = document.getElementById("results");
			resultsDiv.innerHTML = vote.getRankingResult().rankedPairs().join(" ");
		}
	</script>
	</body>
</html>